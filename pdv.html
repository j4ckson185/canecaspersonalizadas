<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV - Canecas Personalizadas</title>
    <style>
        :root {
            --primary: #3a7bd5;
            --secondary: #3a6073;
            --bg-light: #f8f9fa;
            --text-dark: #343a40;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            margin-bottom: 30px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
        }

        .panel {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .panel.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--bg-light);
            font-weight: bold;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .status-novo { background: #cce5ff; color: #004085; }
        .status-processando { background: #fff3cd; color: #856404; }
        .status-enviado { background: #d4edda; color: #155724; }
        .status-entregue { background: #c3e6cb; color: #155724; }
        .status-cancelado { background: #f8d7da; color: #721c24; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .menu-item, .category-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
            }
        }

        .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.product-card {
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.product-card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 4px;
}

.banner-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.category-card img {
    width: 100%;
    max-width: 200px;
    height: 200px;
    object-fit: cover;
    margin-bottom: 1rem;
}
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>Sistema PDV - Canecas Personalizadas</h1>
        </div>
    </div>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPanel('pedidos')">Pedidos</button>
            <button class="nav-tab" onclick="showPanel('clientes')">Clientes</button>
            <button class="nav-tab" onclick="showPanel('produtos')">Produtos</button>
            <button class="nav-tab" onclick="showPanel('categorias')">Categorias</button>
            <button class="nav-tab" onclick="showPanel('fretes')">Fretes</button>
            <button class="nav-tab" onclick="showPanel('configuracoes')">Configurações</button>
        </div>

        <!-- Painel de Pedidos -->
        <div id="pedidos" class="panel active">
            <h2>Pedidos Recentes</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Produto</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="pedidosTable">
                        <!-- Preenchido via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Painel de Clientes -->
        <div id="clientes" class="panel">
            <h2>Gerenciar Clientes</h2>
            <div class="grid">
                <div>
                    <h3>Lista de Clientes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Pedidos</th>
                                <th>Total Gasto</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="clientesTable">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Painel de Produtos -->
        <div id="produtos" class="panel">
            <h2>Gerenciar Produtos</h2>
            <div class="grid">
                <div>
                    <h3>Novo Produto</h3>
                    <div class="form-group">
                        <label>Nome do Produto</label>
                        <input type="text" id="produtoNome">
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="produtoCategoria">
                            <!-- Preenchido via JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Descrição</label>
                        <textarea id="produtoDescricao" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Imagem</label>
                        <input type="file" id="produtoImagem" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label>Preço Base (R$)</label>
                        <input type="number" id="produtoPreco" step="0.01">
                    </div>
                    <button class="btn btn-primary" onclick="pdv.salvarProduto()">Salvar Produto</button>
                </div>
                <div>
                    <h3>Lista de Produtos</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Categoria</th>
                                <th>Preço</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="produtosTable">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Painel de Categorias -->
        <div id="categorias" class="panel">
            <h2>Gerenciar Categorias</h2>
<!-- Substitua o formulário de categoria existente por este -->
<div class="form-group">
    <h3>Nova Categoria</h3>
    <div class="form-group">
        <label>Nome da Categoria</label>
        <input type="text" id="categoriaNome" required>
    </div>
    <div class="form-group">
        <label>Descrição</label>
        <textarea id="categoriaDescricao" rows="3"></textarea>
    </div>
    <div class="form-group">
        <label>Imagem da Categoria</label>
        <input type="file" id="categoriaImagem" accept="image/*">
    </div>
    <div class="form-group">
        <label>Link (URL da página da categoria)</label>
        <input type="text" id="categoriaLink">
    </div>
    <div class="form-group">
        <label>
            <input type="checkbox" id="categoriaPopular">
            Exibir como Categoria Popular na página inicial
        </label>
    </div>
    <button class="btn btn-primary" onclick="pdv.salvarCategoria()">Salvar Categoria</button>
</div>
            <div class="grid">
    <div>
        <h3>Produtos por Categoria</h3>
        <select id="categoriaProdutos" onchange="pdv.mostrarProdutosCategoria(this.value)">
            <option value="">Selecione uma categoria</option>
        </select>
        <div id="produtosCategoria" class="products-grid">
            <!-- Produtos serão mostrados aqui -->
        </div>
    </div>
</div>
<div>
                    <h3>Lista de Categorias</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Link</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="categoriasTable">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Painel de Configurações de Frete -->
        <div id="fretes" class="panel">
            <h2>Configurações de Frete</h2>
            <div class="grid">
                <div>
                    <h3>Taxas por Bairro</h3>
                    <div class="form-group">
                        <label>Bairro</label>
                        <input type="text" id="bairroNome">
                        <label>Taxa de Entrega (R$)</label>
                        <input type="number" id="bairroTaxa" step="0.01">
                        <button class="btn btn-primary" onclick="pdv.salvarTaxaBairro()">Adicionar Taxa</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Bairro</th>
                                <th>Taxa</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="taxasTable">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Painel de Configurações -->
        <div id="configuracoes" class="panel">
            <h2>Configurações Gerais</h2>
            <div class="grid">
                <div>
                    <h3>Preços dos Produtos</h3>
                    <div class="form-group">
                        <label>Preço - Um Lado (R$)</label>
                        <input type="number" id="precoUmLado" value="30.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Preço - Dois Lados (R$)</label>
                        <input type="number" id="precoDoisLados" value="35.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Preço - Caixinha (R$)</label>
                        <input type="number" id="precoCaixinha" value="5.00" step="0.01">
                    </div>
                    <button class="btn btn-primary" onclick="pdv.salvarConfiguracoes()">Salvar Configurações</button>
                </div>
                
                <div>
                    <h3>Configurações do Site</h3>
                    <div class="form-group">
                        <label>Banner Principal</label>
                        <input type="file" id="bannerImage" accept="image/*">
                        <input type="text" id="bannerLink" placeholder="Link do Banner">
                        <input type="text" id="bannerText" placeholder="Texto do Banner">
                    </div>
                    <button class="btn btn-primary" onclick="pdv.salvarConfiguracoesSite()">Salvar Configurações do Site</button>
                </div>
            </div>
        </div>

        <!-- Modal de Detalhes do Pedido -->
        <div id="orderDetailsModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Detalhes do Pedido</h2>
                <div id="orderDetails"></div>
            </div>
        </div>
    </div>

    <script>
        // Classe principal do PDV
        class PDVSystem {
            constructor() {
                this.webAppUrl = 'https://script.google.com/macros/s/AKfycbx2Hc_jM-Udf_1oXZ_1uSU8GWFsKFTn2m-m07IqeDTWV-HaA4SV3lUChWIrigkNzW1ZuQ/exec';
                this.loadData();
                this.initializeListeners();
            }

loadData() {
    const siteConfig = JSON.parse(localStorage.getItem('siteConfig')) || {};
    
    this.pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];
    this.clientes = JSON.parse(localStorage.getItem('clientes')) || [];
    this.produtos = JSON.parse(localStorage.getItem('produtos')) || [];
    this.categorias = siteConfig.categorias || [];
    this.taxasBairros = JSON.parse(localStorage.getItem('taxasBairros')) || [];
    this.configuracoes = siteConfig || this.getDefaultConfigs();
    
    // Salvar tudo no siteConfig para sincronizar
    const newSiteConfig = {
        banner: this.configuracoes.banner,
        categorias: this.categorias,
        precos: this.configuracoes.precos
    };
    localStorage.setItem('siteConfig', JSON.stringify(newSiteConfig));
    
    this.carregarPedidos();
}

            getDefaultConfigs() {
                return {
                    precos: {
                        umLado: 30.00,
                        doisLados: 35.00,
                        caixinha: 5.00
                    },
                    banner: {
                        imagem: '',
                        link: '',
                        texto: ''
                    }
                };
            }

            async carregarPedidos() {
                try {
                    const response = await fetch(this.webAppUrl);
                    const data = await response.json();
                    
                    if (data.orders) {
                        this.renderizarPedidos(data.orders);
                        this.atualizarListaClientes(data.orders);
                    }
                } catch (error) {
                    console.error('Erro ao carregar pedidos:', error);
                }
            }

            renderizarPedidos(pedidos) {
                const tbody = document.getElementById('pedidosTable');
                if (!tbody) return;

                tbody.innerHTML = pedidos.map(pedido => `
                    <tr>
                        <td>${this.formatarData(pedido.data)}</td>
                        <td>${pedido.cliente.nome}</td>
                        <td>${pedido.produto.tipo}</td>
                        <td>R$ ${parseFloat(pedido.valorTotal).toFixed(2)}</td>
                        <td>
                            <select onchange="pdv.atualizarStatus(${pedido.id}, this.value)" class="status-select">
                                <option value="Novo Pedido" ${pedido.status === 'Novo Pedido' ? 'selected' : ''}>Novo Pedido</option>
                                <option value="Em Produção" ${pedido.status === 'Em Produção' ? 'selected' : ''}>Em Produção</option>
                                <option value="Enviado" ${pedido.status === 'Enviado' ? 'selected' : ''}>Enviado</option>
                                <option value="Entregue" ${pedido.status === 'Entregue' ? 'selected' : ''}>Entregue</option>
                                <option value="Cancelado" ${pedido.status === 'Cancelado' ? 'selected' : ''}>Cancelado</option>
                            </select>
                        </td>
                        <td>
                            <button class="btn btn-secondary" onclick="pdv.verPedido(${pedido.id})">Ver Detalhes</button>
                        </td>
                    </tr>
                `).join('');
            }

            atualizarListaClientes(pedidos) {
                const clientes = {};
                
                // Agrupar pedidos por cliente
                pedidos.forEach(pedido => {
                    const clienteKey = pedido.cliente.nome + pedido.cliente.telefone;
                    if (!clientes[clienteKey]) {
                        clientes[clienteKey] = {
                            nome: pedido.cliente.nome,
                            telefone: pedido.cliente.telefone,
                            pedidos: [],
                            totalGasto: 0
                        };
                    }
                    clientes[clienteKey].pedidos.push(pedido);
                    clientes[clienteKey].totalGasto += parseFloat(pedido.valorTotal);
                });

                const tbody = document.getElementById('clientesTable');
                if (!tbody) return;

                tbody.innerHTML = Object.values(clientes).map(cliente => `
                    <tr>
                        <td>${cliente.nome}</td>
                        <td>${cliente.pedidos.length}</td>
                        <td>R$ ${cliente.totalGasto.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="pdv.verCliente('${cliente.nome}')">Ver Pedidos</button>
                        </td>
                    </tr>
                `).join('');
            }

            async atualizarStatus(pedidoId, novoStatus) {
                try {
                    const response = await fetch(this.webAppUrl, {
                        method: 'POST',
                        body: JSON.stringify({
                            action: 'updateStatus',
                            orderId: pedidoId,
                            status: novoStatus
                        })
                    });

                    const data = await response.json();
                    if (data.success) {
                        await this.carregarPedidos();
                    }
                } catch (error) {
                    console.error('Erro ao atualizar status:', error);
                    alert('Erro ao atualizar status do pedido');
                }
            }

            verPedido(pedidoId) {
                const modal = document.getElementById('orderDetailsModal');
                const pedido = this.pedidos.find(p => p.id === pedidoId);

                if (!pedido) return;

                document.getElementById('orderDetails').innerHTML = `
                    <div class="order-details">
                        <h3>Cliente</h3>
                        <p><strong>Nome:</strong> ${pedido.cliente.nome}</p>
                        <p><strong>Telefone:</strong> ${pedido.cliente.telefone}</p>
                        <p><strong>Endereço:</strong> ${pedido.cliente.endereco}</p>

                        <h3>Produto</h3>
                        <p><strong>Tipo:</strong> ${pedido.produto.tipo}</p>
                        <p><strong>Caixinha:</strong> ${pedido.produto.caixinha ? 'Sim' : 'Não'}</p>
                        ${pedido.produto.imagemFrente ? `<p><a href="${pedido.produto.imagemFrente}" target="_blank">Ver Imagem Frontal</a></p>` : ''}
                        ${pedido.produto.imagemVerso ? `<p><a href="${pedido.produto.imagemVerso}" target="_blank">Ver Imagem Verso</a></p>` : ''}

                        <h3>Frete</h3>
                        <p><strong>Tipo:</strong> ${pedido.frete.tipo}</p>
                        <p><strong>Valor:</strong> R$ ${pedido.frete.valor.toFixed(2)}</p>

                        <h3>Total</h3>
                        <p><strong>R$ ${pedido.valorTotal.toFixed(2)}</strong></p>
                    </div>
                `;

                modal.style.display = 'block';
            }

            verCliente(nomeCliente) {
                const pedidosCliente = this.pedidos.filter(p => p.cliente.nome === nomeCliente);
                const modal = document.getElementById('orderDetailsModal');

                document.getElementById('orderDetails').innerHTML = `
                    <h3>Pedidos de ${nomeCliente}</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Produto</th>
                                <th>Valor</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pedidosCliente.map(pedido => `
                                <tr>
                                    <td>${this.formatarData(pedido.data)}</td>
                                    <td>${pedido.produto.tipo}</td>
                                    <td>R$ ${pedido.valorTotal.toFixed(2)}</td>
                                    <td>${pedido.status}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                modal.style.display = 'block';
            }

            formatarData(data) {
                return new Date(data).toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

        // Gerenciamento de produtos e categorias
            salvarProduto() {
                const produto = {
                    id: Date.now(),
                    nome: document.getElementById('produtoNome').value,
                    categoria: document.getElementById('produtoCategoria').value,
                    descricao: document.getElementById('produtoDescricao').value,
                    preco: parseFloat(document.getElementById('produtoPreco').value),
                    imagem: document.getElementById('produtoImagem').files[0] ? 
                        URL.createObjectURL(document.getElementById('produtoImagem').files[0]) : ''
                };

                if (!produto.nome || !produto.categoria || !produto.preco) {
                    alert('Por favor, preencha todos os campos obrigatórios');
                    return;
                }

                this.produtos.push(produto);
                localStorage.setItem('produtos', JSON.stringify(this.produtos));
                this.renderizarProdutos();
                this.limparFormularioProduto();
            }

            renderizarProdutos() {
                const tbody = document.getElementById('produtosTable');
                if (!tbody) return;

                tbody.innerHTML = this.produtos.map(produto => `
                    <tr>
                        <td>${produto.nome}</td>
                        <td>${produto.categoria}</td>
                        <td>R$ ${produto.preco.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="pdv.editarProduto(${produto.id})">Editar</button>
                            <button class="btn btn-danger" onclick="pdv.excluirProduto(${produto.id})">Excluir</button>
                        </td>
                    </tr>
                `).join('');
            }

            editarProduto(produtoId) {
                const produto = this.produtos.find(p => p.id === produtoId);
                if (!produto) return;

                document.getElementById('produtoNome').value = produto.nome;
                document.getElementById('produtoCategoria').value = produto.categoria;
                document.getElementById('produtoDescricao').value = produto.descricao;
                document.getElementById('produtoPreco').value = produto.preco;

                this.produtoEmEdicao = produtoId;
            }

            excluirProduto(produtoId) {
                if (!confirm('Tem certeza que deseja excluir este produto?')) return;

                this.produtos = this.produtos.filter(p => p.id !== produtoId);
                localStorage.setItem('produtos', JSON.stringify(this.produtos));
                this.renderizarProdutos();
            }

            limparFormularioProduto() {
                document.getElementById('produtoNome').value = '';
                document.getElementById('produtoCategoria').value = '';
                document.getElementById('produtoDescricao').value = '';
                document.getElementById('produtoPreco').value = '';
                document.getElementById('produtoImagem').value = '';
                this.produtoEmEdicao = null;
            }

            renderizarCategorias() {
                const tbody = document.getElementById('categoriasTable');
                if (!tbody) return;

                tbody.innerHTML = this.categorias.map(categoria => `
                    <tr>
                        <td>${categoria.nome}</td>
                        <td>${categoria.link}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="pdv.editarCategoria(${categoria.id})">Editar</button>
                            <button class="btn btn-danger" onclick="pdv.excluirCategoria(${categoria.id})">Excluir</button>
                        </td>
                    </tr>
                `).join('');
            }

            editarCategoria(categoriaId) {
                const categoria = this.categorias.find(c => c.id === categoriaId);
                if (!categoria) return;

                document.getElementById('categoriaNome').value = categoria.nome;
                document.getElementById('categoriaDescricao').value = categoria.descricao;
                document.getElementById('categoriaLink').value = categoria.link;

                this.categoriaEmEdicao = categoriaId;
            }

            excluirCategoria(categoriaId) {
                if (!confirm('Tem certeza que deseja excluir esta categoria?')) return;

                this.categorias = this.categorias.filter(c => c.id !== categoriaId);
                localStorage.setItem('categorias', JSON.stringify(this.categorias));
                this.renderizarCategorias();
                this.atualizarSelectCategorias();
            }

async salvarCategoria() {
    const imagemFile = document.getElementById('categoriaImagem').files[0];
    const categoria = {
        id: this.categoriaEmEdicao || Date.now(),
        nome: document.getElementById('categoriaNome').value,
        descricao: document.getElementById('categoriaDescricao').value,
        link: document.getElementById('categoriaLink').value,
        popular: document.getElementById('categoriaPopular').checked,
        imagem: imagemFile ? await this.getBase64(imagemFile) : 
                (this.categoriaEmEdicao ? this.categorias.find(c => c.id === this.categoriaEmEdicao)?.imagem : '')
    };

    if (!categoria.nome) {
        alert('Por favor, insira o nome da categoria');
        return;
    }

    if (this.categoriaEmEdicao) {
        const index = this.categorias.findIndex(c => c.id === this.categoriaEmEdicao);
        if (index !== -1) {
            this.categorias[index] = categoria;
        }
    } else {
        this.categorias.push(categoria);
    }

    // Atualizar tanto categorias quanto configurações
    localStorage.setItem('categorias', JSON.stringify(this.categorias));
    const configuracoes = JSON.parse(localStorage.getItem('configuracoes')) || {};
    configuracoes.categorias = this.categorias;
    localStorage.setItem('configuracoes', JSON.stringify(configuracoes));

    this.renderizarCategorias();
    this.atualizarSelectCategorias();
    this.limparFormularioCategoria();
}
            limparFormularioCategoria() {
                document.getElementById('categoriaNome').value = '';
                document.getElementById('categoriaDescricao').value = '';
                document.getElementById('categoriaLink').value = '';
                document.getElementById('categoriaImagem').value = '';
                this.categoriaEmEdicao = null;
            }

            atualizarSelectCategorias() {
                const select = document.getElementById('produtoCategoria');
                if (!select) return;

                select.innerHTML = `
                    <option value="">Selecione uma categoria</option>
                    ${this.categorias.map(categoria => `
                        <option value="${categoria.nome}">${categoria.nome}</option>
                    `).join('')}
                `;
            }

            mostrarProdutosCategoria(categoria) {
                const produtosDiv = document.getElementById('produtosCategoria');
    if (!produtosDiv) return;

    const produtosCategoria = this.produtos.filter(p => p.categoria === categoria);

    if (produtosCategoria.length === 0) {
        produtosDiv.innerHTML = '<p>Nenhum produto cadastrado nesta categoria.</p>';
        return;
    }

    produtosDiv.innerHTML = produtosCategoria.map(produto => `
        <div class="product-card">
            ${produto.imagem ? `<img src="${produto.imagem}" alt="${produto.nome}">` : ''}
            <h4>${produto.nome}</h4>
            <p>${produto.descricao}</p>
            <p class="price">R$ ${produto.preco.toFixed(2)}</p>
            <button class="btn btn-secondary" onclick="pdv.editarProduto(${produto.id})">Editar</button>
            <button class="btn btn-danger" onclick="pdv.excluirProduto(${produto.id})">Excluir</button>
        </div>
    `).join('');
}
            // Gerenciamento de taxas de entrega
            salvarTaxaBairro() {
                const bairro = document.getElementById('bairroNome').value;
                const taxa = parseFloat(document.getElementById('bairroTaxa').value);

                if (!bairro || isNaN(taxa)) {
                    alert('Por favor, preencha todos os campos corretamente');
                    return;
                }

                this.taxasBairros.push({
                    id: Date.now(),
                    bairro,
                    valor: taxa
                });

                localStorage.setItem('taxasBairros', JSON.stringify(this.taxasBairros));
                this.renderizarTaxas();
                this.limparFormularioTaxa();
            }

            renderizarTaxas() {
                const tbody = document.getElementById('taxasTable');
                if (!tbody) return;

                tbody.innerHTML = this.taxasBairros.map(taxa => `
                    <tr>
                        <td>${taxa.bairro}</td>
                        <td>R$ ${taxa.valor.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="pdv.editarTaxa(${taxa.id})">Editar</button>
                            <button class="btn btn-danger" onclick="pdv.excluirTaxa(${taxa.id})">Excluir</button>
                        </td>
                    </tr>
                `).join('');
            }

            editarTaxa(taxaId) {
                const taxa = this.taxasBairros.find(t => t.id === taxaId);
                if (!taxa) return;

                document.getElementById('bairroNome').value = taxa.bairro;
                document.getElementById('bairroTaxa').value = taxa.valor;

                this.taxaEmEdicao = taxaId;
            }

            excluirTaxa(taxaId) {
                if (!confirm('Tem certeza que deseja excluir esta taxa?')) return;

                this.taxasBairros = this.taxasBairros.filter(t => t.id !== taxaId);
                localStorage.setItem('taxasBairros', JSON.stringify(this.taxasBairros));
                this.renderizarTaxas();
            }

            limparFormularioTaxa() {
                document.getElementById('bairroNome').value = '';
                document.getElementById('bairroTaxa').value = '';
                this.taxaEmEdicao = null;
            }

async salvarConfiguracoesSite() {
    try {
        const bannerFile = document.getElementById('bannerImage').files[0];
        const bannerLink = document.getElementById('bannerLink').value;
        const bannerText = document.getElementById('bannerText').value;

        // Salvar banner
        const bannerConfig = {
            link: bannerLink,
            text: bannerText,
            image: bannerFile ? await this.getBase64(bannerFile) : this.configuracoes.banner?.image
        };

        // Atualizar configurações
        const configuracoes = {
            ...this.configuracoes,
            banner: bannerConfig,
            categorias: this.categorias
        };

        localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
        localStorage.setItem('categorias', JSON.stringify(this.categorias));

        alert('Configurações salvas com sucesso!');
    } catch (error) {
        console.error('Erro ao salvar configurações:', error);
        alert('Erro ao salvar configurações do site');
    }
}
    getBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }

    initializeListeners() {
                // Fechar modal
                const modal = document.getElementById('orderDetailsModal');
                const span = document.getElementsByClassName('close')[0];

                if (span) {
                    span.onclick = function() {
                        modal.style.display = 'none';
                    };
                }

                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = 'none';
                    }
                };
            }
        }

        // Funções globais
        function showPanel(panelId) {
            document.querySelectorAll('.panel').forEach(panel => {
                panel.style.display = 'none';
            });

            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(panelId).style.display = 'block';
            event.target.classList.add('active');
        }

        // Inicializar PDV
        const pdv = new PDVSystem();
    </script>
</body>
</html>
